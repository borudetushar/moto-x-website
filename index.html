<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOTO-X | Journey to the Road</title>
    
    <script> 
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        if(localStorage.getItem('consentMode') === null) {
            // Default: Deny everything
            gtag('consent', 'default', {
                'ad_storage': 'denied',
                'analytics_storage': 'denied',
                'ad_user_data': 'denied',
                'ad_personalization': 'denied',
                'wait_for_update': 500
            });
        } else {
            // Restore previous choice
            var storedConsent = JSON.parse(localStorage.getItem('consentMode'));
            gtag('consent', 'default', storedConsent);
        }
    </script>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PDC3P7SS');</script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #f4f4f4; color: #333; }
        nav { background: #111; padding: 15px; color: white; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        nav h1 { margin: 0; color: #ff4d4d; letter-spacing: 2px; }
        nav div { display: flex; align-items: center; }
        nav a { color: white; text-decoration: none; margin: 0 15px; font-weight: 500; cursor: pointer; }
        nav a:hover { color: #ff4d4d; }
        .hero { background: #333; color: white; padding: 100px 20px; text-align: center; }
        .hero h2 { font-size: 3em; margin: 0; }
        .btn { background: #ff4d4d; color: white; padding: 10px 20px; border: none; cursor: pointer; font-size: 1.1em; margin-top: 20px; text-decoration: none; display: inline-block; border-radius: 4px; }
        .btn:hover { background: #ff3333; }
        .container { padding: 40px 20px; max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 250px; object-fit: cover; border-radius: 5px; background: #eee; }
        .price { color: #ff4d4d; font-weight: bold; font-size: 1.2em; margin: 10px 0; }
        
        /* VIEWS */
        #detail-view, #dealers-view, #support-view { display: none; background: white; padding: 40px; border-radius: 8px; max-width: 900px; margin: 40px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #detail-img { width: 100%; height: 400px; object-fit: cover; border-radius: 8px; }
        #compare-section { display: none; background: white; padding: 40px; margin-top: 40px; border-radius: 8px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        
        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; z-index: 200; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 30px; width: 400px; border-radius: 8px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .close { float: right; cursor: pointer; font-size: 1.5em; color: #999; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        #otp-section { display: none; background: #e8f0fe; padding: 15px; border-radius: 4px; margin-top: 10px; border: 1px solid #b3d7ff; }
        
        /* EXTRA PAGES */
        .dealer-card { border: 1px solid #ddd; padding: 15px; margin-top: 10px; border-radius: 5px; background: #f9f9f9; display: none; }
        .contact-box { text-align: center; padding: 20px; background: #f9f9f9; border-radius: 8px; margin-bottom: 20px; }
        .contact-box h3 { color: #ff4d4d; margin-bottom: 5px; }

        /* CONSENT BANNER (Restored) */
        #consent-banner { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0, 0, 0, 0.9); color: white; padding: 20px; text-align: center; z-index: 9999; display: none; box-shadow: 0 -2px 10px rgba(0,0,0,0.2); }
        .consent-btn { padding: 10px 20px; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; margin: 0 10px; }
        .btn-accept { background: #28a745; color: white; }
        .btn-deny { background: #666; color: white; }
    </style>
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PDC3P7SS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <nav>
        <h1>MOTO-X</h1>
        <div>
            <a onclick="showHome()">Home</a>
            <a onclick="showHome()">Vehicles</a>
            <a onclick="toggleCompare()">Compare</a>
            <a onclick="showDealers()">Dealers</a>
            <a onclick="showSupport()">Support</a>
            <button class="btn" style="margin-left: 15px; font-size: 0.9em; margin-top: 0;" onclick="openModal()">Book Test Drive</button>
        </div>
    </nav>

    <div id="home-view">
        <div class="hero"><h2>Experience the Thrill</h2><p>Discover our new range of performance bikes.</p><a href="#vehicles" class="btn">View All Models</a></div>
        <div class="container" id="vehicles">
            <h3>Featured This Month</h3>
            <div class="grid">
                <div class="card vehicle-card">
                    <img src="bike.jpg" alt="Thunder X1">
                    <h3>Thunder X1 (Bike)</h3><p>500cc | 6-Speed | ABS</p><p class="price">Starts at $2,500</p>
                    <button class="btn" onclick="handleProductClick('Thunder X1', 'MOTO-500', 2500, 'Motorcycle', 'bike.jpg')">View Details</button>
                </div>
                <div class="card vehicle-card">
                    <img src="scooter.jpg" alt="Scoot S-Pro">
                    <h3>Scoot S-Pro (Scooter)</h3><p>125cc | Automatic | Eco Mode</p><p class="price">Starts at $1,200</p>
                    <button class="btn" onclick="handleProductClick('Scoot S-Pro', 'SCOOT-125', 1200, 'Scooter', 'scooter.jpg')">View Details</button>
                </div>
            </div>
            <div id="compare-section">
                <h3>Vehicle Comparison</h3>
                <table><tr><th>Feature</th><th>Thunder X1</th><th>Scoot S-Pro</th></tr><tr><td>Engine</td><td>500cc Twin</td><td>125cc Single</td></tr><tr><td>Price</td><td>$2,500</td><td>$1,200</td></tr></table>
            </div>
        </div>
    </div>

    <div id="detail-view">
        <button class="btn" onclick="showHome()" style="background: #555; margin-bottom: 20px;">&larr; Back to Vehicles</button>
        <div class="grid" style="grid-template-columns: 1fr 1fr; align-items: start;">
            <img id="detail-img" src="" alt="Vehicle">
            <div style="padding-left: 20px;">
                <h2 id="detail-title"></h2><p id="detail-cat" style="color:#666;font-weight:bold;"></p><p class="price" id="detail-price"></p>
                <p>Experience the ultimate ride with our latest technology.</p>
                <button class="btn" onclick="openModal()">Book Test Drive Now</button>
            </div>
        </div>
    </div>

    <div id="dealers-view">
        <h2>Find a MOTO-X Dealer</h2>
        <select id="citySelect" onchange="filterDealers()"><option value="">-- Choose City --</option><option value="ny">New York, NY</option><option value="la">Los Angeles, CA</option><option value="ch">Chicago, IL</option></select>
        <div id="dealer-ny" class="dealer-card"><h3>MOTO-X New York</h3><p>123 Broadway Ave</p></div>
        <div id="dealer-la" class="dealer-card"><h3>MOTO-X Santa Monica</h3><p>450 Ocean Blvd</p></div>
        <div id="dealer-ch" class="dealer-card"><h3>MOTO-X Chicago</h3><p>78 Michigan Ave</p></div>
    </div>

    <div id="support-view">
        <h2>Customer Support</h2>
        <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top: 30px;">
            <div class="contact-box"><h3>üìû Call Us</h3><p>+1 (800) MOTO-HELP</p></div>
            <div class="contact-box"><h3>‚úâÔ∏è Email Us</h3><p>support@moto-x.com</p></div>
        </div>
    </div>

    <div id="leadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span><h3 id="modalTitle">Book Test Drive</h3>
            <form id="leadForm" onsubmit="handleFormSubmit(event)">
                <input type="text" id="name" placeholder="Full Name" required oninput="trackFormStart()" onchange="trackStep('Full Name')">
                <input type="email" id="email" placeholder="Email Address" required onchange="trackStep('Email Address')">
                <input type="tel" id="phone" placeholder="Phone Number" required onchange="trackStep('Phone Number')">
                <select id="modelSelect"><option value="Thunder X1">Thunder X1</option><option value="Scoot S-Pro">Scoot S-Pro</option></select>
                <div id="otp-section"><label>Verification Code</label><p style="font-size:0.8em;">(Code: 1234)</p><input type="text" id="otpInput" placeholder="Enter OTP"></div>
                <button type="submit" id="submitBtn" class="btn" style="width: 100%;">Send Verification Code</button>
            </form>
        </div>
    </div>

    <div id="consent-banner">
        <p><strong>We use cookies to improve your experience.</strong><br>Allow us to track analytics and personalize ads? (Consent Mode v2)</p>
        <button class="consent-btn btn-accept" onclick="acceptConsent()">Accept All</button>
        <button class="consent-btn btn-deny" onclick="denyConsent()">Deny All</button>
    </div>

    <script>
        // --- 1. GLOBAL VARIABLES ---
        let currentVehicle = null; 
        let hasFormStarted = false;

        // --- 2. INIT LOGIC (VIEW ITEM LIST - NEW) ---
        // Fires automatically when page loads
        window.addEventListener('load', function() {
            // Show banner if no choice saved
            if(localStorage.getItem('consentMode') === null) {
                document.getElementById('consent-banner').style.display = 'block';
            }

            // Fire view_item_list
            window.dataLayer.push({
                'event': 'view_item_list',
                'ecommerce': {
                    'currency': 'USD',
                    'items': [
                        { 'item_id': 'MOTO-500', 'item_name': 'Thunder X1', 'price': 2500, 'item_category': 'Motorcycle' },
                        { 'item_id': 'SCOOT-125', 'item_name': 'Scoot S-Pro', 'price': 1200, 'item_category': 'Scooter' }
                    ]
                }
            });
        });

        // --- 3. CLICK & DETAIL LOGIC (SELECT ITEM - NEW) ---
        function handleProductClick(name, id, price, category, imageUrl) {
            // 1. Fire select_item event
            window.dataLayer.push({
                'event': 'select_item',
                'ecommerce': {
                    'currency': 'USD',
                    'items': [{ 'item_id': id, 'item_name': name, 'item_category': category, 'price': price }]
                }
            });
            // 2. Load Details
            setTimeout(() => { loadVehicleDetail(name, id, price, category, imageUrl); }, 100);
        }

        function loadVehicleDetail(name, id, price, category, imageUrl) {
            hideAllViews();
            document.getElementById('detail-view').style.display = 'block';
            document.getElementById('detail-title').innerText = name;
            document.getElementById('detail-cat').innerText = category;
            document.getElementById('detail-price').innerText = "$" + price.toLocaleString();
            document.getElementById('detail-img').src = imageUrl; 
            window.scrollTo(0, 0);

            currentVehicle = { 'item_id': id, 'item_name': name, 'item_category': category, 'price': price, 'quantity': 1 };
            window.dataLayer.push({
                'event': 'view_item',
                'ecommerce': { 'currency': 'USD', 'value': price, 'items': [currentVehicle] }
            });
        }

        // --- 4. NAVIGATION & DEALER TRACKING ---
        function hideAllViews() {
            document.getElementById('home-view').style.display = 'none';
            document.getElementById('detail-view').style.display = 'none';
            document.getElementById('dealers-view').style.display = 'none';
            document.getElementById('support-view').style.display = 'none';
            document.getElementById('compare-section').style.display = 'none';
        }
        function showHome() { hideAllViews(); document.getElementById('home-view').style.display = 'block'; }
        
        function showDealers() { 
            hideAllViews(); 
            document.getElementById('dealers-view').style.display = 'block'; 
            window.dataLayer.push({'event':'dealer_locate', 'page_title':'Dealers'}); 
        }
        
        function showSupport() { hideAllViews(); document.getElementById('support-view').style.display = 'block'; window.dataLayer.push({'event':'page_view','page_title':'Support'}); }
        
        function filterDealers() {
            document.querySelectorAll('.dealer-card').forEach(d => d.style.display = 'none');
            var city = document.getElementById('citySelect').value;
            if (city) {
                document.getElementById('dealer-' + city).style.display = 'block';
                // New Event: dealer_select
                window.dataLayer.push({'event': 'dealer_select', 'city_id': city});
            }
        }
        
        function toggleCompare() {
            var section = document.getElementById('compare-section');
            if (section.style.display === 'none') {
                section.style.display = 'block';
                window.dataLayer.push({ 'event': 'compare_view', 'compare_items': ['Thunder X1', 'Scoot S-Pro'] });
                section.scrollIntoView({behavior: "smooth"});
            } else { section.style.display = 'none'; }
        }

        // --- 5. CONSENT FUNCTIONS (RESTORED) ---
        function acceptConsent() {
            var consentState = { 'ad_storage': 'granted', 'analytics_storage': 'granted', 'ad_user_data': 'granted', 'ad_personalization': 'granted' };
            gtag('consent', 'update', consentState);
            localStorage.setItem('consentMode', JSON.stringify(consentState));
            document.getElementById('consent-banner').style.display = 'none';
        }

        function denyConsent() {
            var consentState = { 'ad_storage': 'denied', 'analytics_storage': 'denied', 'ad_user_data': 'denied', 'ad_personalization': 'denied' };
            localStorage.setItem('consentMode', JSON.stringify(consentState));
            document.getElementById('consent-banner').style.display = 'none';
        }

        // --- 6. FORM LOGIC ---
        function trackFormStart() { if (!hasFormStarted) { window.dataLayer.push({ 'event': 'form_start' }); hasFormStarted = true; } }
        function trackStep(fieldName) { window.dataLayer.push({ 'event': 'form_step_complete', 'step_name': fieldName }); }

        let otpStep = 1;
        function openModal() {
            document.getElementById('leadModal').style.display = 'flex';
            otpStep = 1; hasFormStarted = false;
            document.getElementById('otp-section').style.display = 'none';
            document.getElementById('submitBtn').innerText = "Send Verification Code";
            document.getElementById('submitBtn').style.background = "#ff4d4d";
            document.getElementById('otpInput').required = false;
            document.getElementById('name').value = ""; document.getElementById('email').value = ""; document.getElementById('phone').value = ""; 
        }
        function closeModal() { document.getElementById('leadModal').style.display = 'none'; }

        function handleFormSubmit(e) {
            e.preventDefault();
            if (otpStep === 1) {
                otpStep = 2;
                document.getElementById('otp-section').style.display = 'block';
                document.getElementById('submitBtn').innerText = "Verify & Book Test Drive";
                document.getElementById('submitBtn').style.background = "#28a745"; 
                document.getElementById('otpInput').required = true;
                window.dataLayer.push({ 'event': 'otp_sent' }); 
                document.getElementById('otpInput').focus();
            } else {
                if (document.getElementById('otpInput').value === '1234') {
                    window.dataLayer.push({ 
                        'event': 'generate_lead', 
                        'ecommerce': { 
                            'currency': 'USD', 
                            'value': currentVehicle ? currentVehicle.price : 0, 
                            'items': currentVehicle ? [currentVehicle] : [] 
                        } 
                    });
                    window.dataLayer.push({ 'event': 'otp_verified' });
                    alert("Test Drive Confirmed!");
                    closeModal();
                } else {
                    alert("Incorrect OTP");
                    window.dataLayer.push({ 'event': 'otp_failed' });
                }
            }
        }
    </script>
</body>
</html>
